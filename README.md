# stm32_usb_mass_hal

#### 介绍

stm32f103c8t6，使用内部flash做u盘的示例，代码使用STM32cubeIDE编译。

本示例是为了回复数码之家论坛一个网友的帖子而专门写的（其实也是因为自己想熟悉一下这个新装的Stm32CubeIde开发环境 ）。示例使用了stm32f103c8t6“赠送”的后64KB flash空间，实现了一个小u盘。板子就是某宝那种最常见的小板，我把A12脚（即USB D+脚）的1.5K上拉电阻拆了，改接在A12与A15之间（这两个脚挨着），代码里控制这个A15启动后上拉，这样做的目的是每次下载代码后，不用重新插拔USB线，就可以被电脑识别，方便实验。

代码只是演示实现方法，实用意义不大。

#### BTW:
另外我想说的是，Stm32CubeIde太好用了，建议玩stm32的朋友都尽快换用这个工具。就拿本例子来说，代码全部是自动生成的，自己添加的语句大约只有10行！强大吧！！快忘了你的STD库吧……



#### 怎样打开这个项目：

由于国内玩STM32单片机的爱好者，大部份都是使用MDK开发环境学习的（我本人就是这样），所以对于这个STM32cubeIDE 新开发环境的操作不熟悉，我自己也是刚接触这个，我测试把这个项目克隆下来，竟然自己都也不能正确打开…… （ #_#! ）好在经过一番摸索，还是成功了，这里把步骤说一下，供需要朋友参考：

1. **怎样克隆项目**

   如果你平时就使用git，那这就不是问题了，直接用一句

   `git clone https://gitee.com/bg4uvr/stm32_usb_mass_hal.git` 

   就可以克隆到本地了。

   如果你没有安装git软件，那么可以直接点击“克隆/下载”，然后点击下面的“下载ZIP”，这样会下载一个ZIP压缩文件，下载好后解压缩就可以得到项目的文件夹了。

2. **怎样打开项目**

   * 安装STM32CubeIDE

     打开官网 https://www.st.com/zh/development-tools/stm32cubeide.html 下载STM32CubeIDE，官网下载需要注册，如果你不想注册也可以去其他地方下载。下载后安装好，不再赘述。

   * 导入项目

     克隆好的项目并不能在 STM32CubeIDE 软件中直接打开，这是因为你下载好后的项目代码，路径和我的电脑上是不一样的，因此需要导入这个项目后才可以。具体操作如果：

     * 打开你的 STM32CubeIDE 软件，如果有更新之类的，都让它自己更新好，其实你安装后，你不用任何设置，它就已经可以很好的工作了。随着你对它的熟悉，你可能会有一些更细致的设置需求，那时你可以再仔细研究，本处略过不说。
     
     * 打开软件后，默认是打开 “Welcome to STM32CubeIDE” 欢迎页面的，但这个页面可能之前被你关掉过了，它就不会再自动打开。如果没自动打开这个页面也没关系，可以点击图标栏上最右一个叹号的图标 “Information Center” (消息中心)，就可以打开这个欢迎页面了。
     * 点击3个蓝色方块的中间一个，“Start new project from STM32CubeMX .ioc file”，在新出现的窗口上点击右侧的 “Browse...”，然后选择刚才克隆好的项目目录，选中 .ioc文件，点击“打开”，再点击 “Finish”，经过一番跑条后，你应该终于看到了一个显示芯片的引脚的界面。
     * 本处是讲如何导入这个项目，所以本页里面具体的设置就不多聊了，直接点击工具栏图标的 “黄色齿轮” 图标（Device Configuration Tool Code Generation），又是一番跑条，点击工具栏图标最后侧 ”蓝色MX“ 图标左面那个图标（C/C++），左侧就可以看到项目管理器了，你可以点击打开各个代码来查看，也可以进行编译下载了。
     * 项目这样导入后，下次就可以直接打开了，不需要再次导入。

好了，如何导入就讲这么多了，如果还有什么问题可以直接在此留言，或者在论坛中回复，我看到后会尽量解答，祝大家学习愉快，共同进步~

bg4uvr @ 2020.4.22